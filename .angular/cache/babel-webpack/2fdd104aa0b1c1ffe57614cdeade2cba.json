{"ast":null,"code":"import { ChangeDetectorRef, ElementRef, forwardRef, Provider, Renderer2 } from '@angular/core';\nimport { AbstractControl, NG_VALIDATORS, NG_VALUE_ACCESSOR, ValidationErrors } from '@angular/forms';\nimport { formatDate, getLocale, isAfter, isBefore, isDate, isDateValid, parseDate, utcAsLocal } from 'ngx-bootstrap/chronos';\nimport { BsDatepickerDirective } from './bs-datepicker.component';\nimport { BsLocaleService } from './bs-locale.service';\nimport { Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./bs-datepicker.component\";\nimport * as i2 from \"./bs-locale.service\";\nconst BS_DATEPICKER_VALUE_ACCESSOR = {\n  provide: NG_VALUE_ACCESSOR,\n  useExisting: forwardRef(() => BsDatepickerInputDirective),\n  multi: true\n};\nconst BS_DATEPICKER_VALIDATOR = {\n  provide: NG_VALIDATORS,\n  useExisting: forwardRef(() => BsDatepickerInputDirective),\n  multi: true\n};\nexport let BsDatepickerInputDirective = /*#__PURE__*/(() => {\n  class BsDatepickerInputDirective {\n    constructor(_picker, _localeService, _renderer, _elRef, changeDetection) {\n      this._picker = _picker;\n      this._localeService = _localeService;\n      this._renderer = _renderer;\n      this._elRef = _elRef;\n      this.changeDetection = changeDetection;\n      this._onChange = Function.prototype;\n      this._onTouched = Function.prototype;\n      this._validatorChange = Function.prototype;\n      this._subs = new Subscription();\n    }\n\n    ngOnInit() {\n      const setBsValue = value => {\n        this._setInputValue(value);\n\n        if (this._value !== value) {\n          this._value = value;\n\n          this._onChange(value);\n\n          this._onTouched();\n        }\n\n        this.changeDetection.markForCheck();\n      }; // if value set via [bsValue] it will not get into value change\n\n\n      if (this._picker._bsValue) {\n        setBsValue(this._picker._bsValue);\n      } // update input value on datepicker value update\n\n\n      this._subs.add(this._picker.bsValueChange.subscribe(setBsValue)); // update input value on locale change\n\n\n      this._subs.add(this._localeService.localeChange.subscribe(() => {\n        this._setInputValue(this._value);\n      }));\n\n      this._subs.add(this._picker.dateInputFormat$.pipe(distinctUntilChanged()).subscribe(() => {\n        this._setInputValue(this._value);\n      }));\n    }\n\n    ngOnDestroy() {\n      this._subs.unsubscribe();\n    }\n\n    onKeydownEvent(event) {\n      if (event.keyCode === 13 || event.code === 'Enter') {\n        this.hide();\n      }\n    }\n\n    _setInputValue(value) {\n      const initialDate = !value ? '' : formatDate(value, this._picker._config.dateInputFormat, this._localeService.currentLocale);\n\n      this._renderer.setProperty(this._elRef.nativeElement, 'value', initialDate);\n    }\n\n    onChange(event) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      this.writeValue(event.target.value);\n\n      this._onChange(this._value);\n\n      if (this._picker._config.returnFocusToInput) {\n        this._renderer.selectRootElement(this._elRef.nativeElement).focus();\n      }\n\n      this._onTouched();\n    }\n\n    validate(c) {\n      const _value = c.value;\n\n      if (_value === null || _value === undefined || _value === '') {\n        return null;\n      }\n\n      if (isDate(_value)) {\n        const _isDateValid = isDateValid(_value);\n\n        if (!_isDateValid) {\n          return {\n            bsDate: {\n              invalid: _value\n            }\n          };\n        }\n\n        if (this._picker && this._picker.minDate && isBefore(_value, this._picker.minDate, 'date')) {\n          this.writeValue(this._picker.minDate);\n          return {\n            bsDate: {\n              minDate: this._picker.minDate\n            }\n          };\n        }\n\n        if (this._picker && this._picker.maxDate && isAfter(_value, this._picker.maxDate, 'date')) {\n          this.writeValue(this._picker.maxDate);\n          return {\n            bsDate: {\n              maxDate: this._picker.maxDate\n            }\n          };\n        }\n      }\n\n      return null;\n    }\n\n    registerOnValidatorChange(fn) {\n      this._validatorChange = fn;\n    }\n\n    writeValue(value) {\n      if (!value) {\n        this._value = void 0;\n      } else {\n        const _localeKey = this._localeService.currentLocale;\n\n        const _locale = getLocale(_localeKey);\n\n        if (!_locale) {\n          throw new Error(`Locale \"${_localeKey}\" is not defined, please add it with \"defineLocale(...)\"`);\n        }\n\n        this._value = parseDate(value, this._picker._config.dateInputFormat, this._localeService.currentLocale);\n\n        if (this._picker._config.useUtc) {\n          this._value = utcAsLocal(this._value);\n        }\n      }\n\n      this._picker.bsValue = this._value;\n    }\n\n    setDisabledState(isDisabled) {\n      this._picker.isDisabled = isDisabled;\n\n      if (isDisabled) {\n        this._renderer.setAttribute(this._elRef.nativeElement, 'disabled', 'disabled');\n\n        return;\n      }\n\n      this._renderer.removeAttribute(this._elRef.nativeElement, 'disabled');\n    }\n\n    registerOnChange(fn) {\n      this._onChange = fn;\n    }\n\n    registerOnTouched(fn) {\n      this._onTouched = fn;\n    }\n\n    onBlur() {\n      this._onTouched();\n    }\n\n    hide() {\n      this._picker.hide();\n\n      this._renderer.selectRootElement(this._elRef.nativeElement).blur();\n\n      if (this._picker._config.returnFocusToInput) {\n        this._renderer.selectRootElement(this._elRef.nativeElement).focus();\n      }\n    }\n\n  }\n\n  BsDatepickerInputDirective.ɵfac = function BsDatepickerInputDirective_Factory(t) {\n    return new (t || BsDatepickerInputDirective)(i0.ɵɵdirectiveInject(i1.BsDatepickerDirective, 1), i0.ɵɵdirectiveInject(i2.BsLocaleService), i0.ɵɵdirectiveInject(i0.Renderer2), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n  };\n\n  BsDatepickerInputDirective.ɵdir = /*@__PURE__*/i0.ɵɵdefineDirective({\n    type: BsDatepickerInputDirective,\n    selectors: [[\"input\", \"bsDatepicker\", \"\"]],\n    hostBindings: function BsDatepickerInputDirective_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"change\", function BsDatepickerInputDirective_change_HostBindingHandler($event) {\n          return ctx.onChange($event);\n        })(\"keyup.esc\", function BsDatepickerInputDirective_keyup_esc_HostBindingHandler() {\n          return ctx.hide();\n        })(\"keydown\", function BsDatepickerInputDirective_keydown_HostBindingHandler($event) {\n          return ctx.onKeydownEvent($event);\n        })(\"blur\", function BsDatepickerInputDirective_blur_HostBindingHandler() {\n          return ctx.onBlur();\n        });\n      }\n    },\n    features: [i0.ɵɵProvidersFeature([BS_DATEPICKER_VALUE_ACCESSOR, BS_DATEPICKER_VALIDATOR])]\n  });\n  return BsDatepickerInputDirective;\n})();","map":null,"metadata":{},"sourceType":"module"}